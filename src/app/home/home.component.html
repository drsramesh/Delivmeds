<p-growl [(value)]="msgs" class="growl-msgs" life="7000"></p-growl>
<!-- <p-table class="orders-table" #dt [columns]="cols" [value]="Orders" [paginator]="false" [rows]="10"></p-table> -->
<!-- <div class="search-results" infiniteScroll [infiniteScrollDistance]="2" [infiniteScrollUpDistance]="1.5" [infiniteScrollThrottle]="20" (scrolled)="OrderList()" [scrollWindow]="false" (scrolledUp)="OrderList()"> -->
<p-table *ngIf="visible" class="orders-table" #dt [columns]="cols" [value]="filterableOrders" sortField="id" [rows]="10" sortOrder=-1>

    <!-- <div infiniteScroll [infiniteScrollDistance]="1" [infiniteScrollThrottle]="50" (scrolled)="onScroll()"> -->
    <!-- sortField="id" [rows]="10" sortOrder=-1 -->
    <ng-template pTemplate="caption">

        <h3 class="pull-left">All Orders</h3>
        <div class="pull-right order-filter" *ngIf="visible">
            <span class="search"><i class="fa fa-search"></i>
                <input type="text" class="order-search" pInputText size="50" placeholder="Search"  (input)="dt.filterGlobal($event.target.value, 'contains')" style="width:100%" >
                                <!-- <input type="text"  class="order-search" pInputText size="50" placeholder="Global Filter" (input)="dt.filterGlobal($event.target.value, 'contains')" style="width:auto"> -->
                    </span>
            <p-dropdown class="drop-down order-dropdown" [options]="listOfOrderTypes" [style]="{'width':'100%'}" (onChange)="sample($event)" optionLabel="name"></p-dropdown>
        </div>

        <div class="clearfix"></div>
    </ng-template>
    <ng-template pTemplate="header" let-columns *ngIf="Orders">
        <tr>
            <th style="width: 130px">
                Order ID
            </th>
            <th style="width: 160px">
                Prescription ID
            </th>
            <th style="width: 200px">
                Patient Name
            </th>
            <th style="width: 200px">
                Order Date
            </th>
            <th style="width:450px">
                Status
            </th>
            <th style="width:150px">
                &nbsp;
            </th>
            <th style="width:350px">
                &nbsp;
            </th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-Order let-columns="columns">
        <tr>
            <td style="width: 130px" routerLink="/order-view/{{Order.id}}">
                {{Order.id}}
            </td>
            <td style="width: 160px" routerLink="/order-view/{{Order.id}}">
                <div>
                    {{Order.prescriptionNo !== null? Order.prescriptionNo : 'N/A' }}
                </div>
            </td>
            <td style="width: 200px" routerLink="/order-view/{{Order.id}}">
                {{Order.patientName}}
                <!-- <div *ngIf="Order.customerResponse.customerMembers && Order.customerResponse.customerMembers.length>0; else patientData ">
                    {{Order.customerResponse.customerMembers[0].firstName}}{{Order.customerResponse.customerMembers[0].lastName}}
                </div>
                <ng-template #patientData>
                    <div> {{Order.customerResponse.firstName}} {{Order.customerResponse.lastName}}
                    </div>
                </ng-template> -->

            </td>
            <td style="width: 200px" routerLink="/order-view/{{Order.id}}">
                {{Order.createdOn }}
            </td>
            <td style="width:450px" routerLink="/order-view/{{Order.id}}">

                <label *ngIf="Order.status == 1"> New <span  *ngIf ="Order.refill == true" class="order-refill">Refill</span></label>
                <label *ngIf="Order.status == 2"> Awaiting Patient Order Confirmation </label>
                <label *ngIf="Order.status == 3"> Rejected</label>
                <label *ngIf="Order.status == 4"> Rejected</label>
                <label *ngIf="Order.status == 5"> Filling Pending</label>
                <!-- <label *ngIf="Order.status == 5 && Order.deliveryType==2 "> Filling Pending</label> -->
                <label *ngIf="Order.status == 6"> Awaiting for Pickup </label>
                <!-- <label *ngIf="Order.status == 6  && Order.deliveryType==2"> Awaiting for Pickup</label> -->
                <label *ngIf="Order.status == 7">Delivered on {{Order.lastModifiedOn}}</label>
            </td>

            <!-- <input type="hidden" [(ngModel)]="Order_one" /> {{Order_one}} -->
            <td style="width:150px">

                &nbsp;
            </td>
            <!-- {{Order.customerResponse.phone}} -->
            <!-- {{Order| json}} -->
            <td style="max-width:350px">
                <p class="orders-loading" *ngIf="Order.loading"> <i class="fa fa-spinner fa-2x fa-spin"></i></p>
                <div class="display-inline">
                    <div *ngIf="Order.status == 5 &&  Order.deliveryType==1 && Order.paymentDone ==false">

                        <button pButton type="button" (click)="ReadyForPickup(Order)" label="Ready For pickup" class="ui-button-secondary btn-secondary-green pull-right"></button>

                    </div>

                    <div *ngIf="Order.status == 5 &&  Order.deliveryType==1 && Order.paymentDone ==true ">

                        <button pButton type="button" (click)="showDialog1(Order)" label="Ready For pickup" class="ui-button-secondary btn-secondary-green pull-right"></button>

                    </div>

                    <div *ngIf="Order.status == 5 &&  Order.deliveryType==2 && Order.paymentDone ==true ">
                        <button pButton type="button" (click)="showDialog1(Order)" label="Ready For pickup" class="ui-button-secondary btn-secondary-green pull-right"></button>

                    </div>
                </div>

                <div class="display-inline">
                    <div *ngIf="Order.status == 6 &&  Order.deliveryType==2 ">
                        <button pButton type="button" (click)="Delivered(Order)" label="Delivered" class="ui-button-secondary btn-secondary-green pull-right"></button>
                    </div>

                    <div *ngIf="Order.status == 6 && Order.deliveryType==1  && Order.paymentDone ==true">
                        <button pButton type="button" (click)="Delivered(Order)" label="Delivered" class="ui-button-secondary btn-secondary-green pull-right"></button>
                    </div>

                    <div *ngIf="Order.status == 6 && Order.deliveryType==1 && Order.paymentDone ==false">
                        <button pButton type="button" (click)="showDialog(Order)" label="Delivered" class="ui-button-secondary btn-secondary-green pull-right"></button>

                    </div>
                </div>
            </td>
            <!-- <td>

            </td> -->

        </tr>
    </ng-template>


</p-table>
<!-- </div> -->

<p-dialog header="Confirmation" class="pop-dailouge" [(visible)]="display" [modal]="true" [width]="350" [minWidth]="200" [minY]="70" [baseZIndex]="10000">
    <span>Patient choose to pay at Register. Had you received prescription amount?   </span>
    <p-footer>
        <input type="hidden" [(ngModel)]="Order_one" />
        <button type="button" class="btn-group-green" pButton (click)="Delivered(Order_one)" label="Paid"></button>
        <button type="button" class="ui-button-secondary btn-secondary-green" pButton (click)="display=false" label="Not Paid"></button>
    </p-footer>
</p-dialog>

<p-dialog header="Confirmation" class="pop-dailouge" [(visible)]="display1" [modal]="true" [width]="350" [minWidth]="200" [minY]="70" [baseZIndex]="10000">
    <span>Customer wish to pay with card. Had you received prescription amount? If not contact customer at {{Order_two?.customerResponse?.mobile_number | slice:0:3}}-{{Order_two?.customerResponse?.mobile_number | slice:3:6}}-{{Order_two?.customerResponse?.mobile_number | slice:6:10}} ?  </span>
    <!-- <span>Customer wish to pay with card. Had you received prescription amount? If not contact customer at {{Order_two?.customerResponse?.mobile_number }} ?  </span> -->
    <p-footer>
        <!-- <input type="hidden" [(ngModel)]="Order_two" /> -->
        <button type="button" class="btn-group-green" pButton (click)="ReadyForPickup(Order_two)" label="Paid"></button>
        <button type="button" class="ui-button-secondary btn-secondary-green" pButton (click)="display1=false" label="Not Paid"></button>
    </p-footer>
</p-dialog>

<p-dialog header="Confirmation" class="pop-dailouge" [(visible)]="display1" [modal]="true" [width]="350" [minWidth]="200" [minY]="70" [baseZIndex]="10000">
    <span>Customer wish to pay with card. Had you received prescription amount? If not contact customer at {{Order_two?.customerResponse?.mobile_number | slice:0:3}}-{{Order_two?.customerResponse?.mobile_number | slice:3:6}}-{{Order_two?.customerResponse?.mobile_number | slice:6:10}} ?  </span>
    <!-- <span>Customer wish to pay with card. Had you received prescription amount? If not contact customer at {{Order_two?.customerResponse?.mobile_number }} ?  </span> -->
    <p-footer>
        <!-- <input type="hidden" [(ngModel)]="Order_two" /> -->
        <button type="button" class="btn-group-green" pButton (click)="ReadyForPickup(Order_two)" label="Paid"></button>
        <button type="button" class="ui-button-secondary btn-secondary-green" pButton (click)="display1=false" label="Not Paid"></button>
    </p-footer>
</p-dialog>
<div class="text-center no-orders" *ngIf="loading == true && Orders.length ==0 && filterableOrders.length ==0">
    No Orders Found
</div>